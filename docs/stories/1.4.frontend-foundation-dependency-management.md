# Story 1.4: Frontend Foundation Setup with Dependency Management

## Status

Ready for Review

## Story

**As a** DSI Product Owner,
**I want** a Next.js frontend foundation with shadcn/ui component library and comprehensive dependency management,
**so that** I can have a modern, type-safe, accessible UI foundation ready for implementing the AgentLab dashboard and project management interface.

## Acceptance Criteria

1. **Initialize Next.js with specific versions:**
   - Next.js 13.4.19+ with App Router
   - TypeScript 5.1.6+ with strict configuration (Epic 1 canonical)
   - React 18.2.0+ for concurrent features

2. **Configure shadcn/ui component library:**
   - shadcn/ui CLI installation and setup
   - Tailwind CSS 3.3.0+ configuration
   - Radix UI primitives for accessibility
   - Lucide React icons for consistency

3. **Dependency conflict resolution strategy:**
   - Package.json with exact versions for critical dependencies
   - Npm audit and vulnerability checking
   - Peer dependency validation
   - Lock file strategy (npm ci for CI/CD)

4. **Frontend-backend integration setup:**
   - API client configuration with type safety
   - Environment variable management
   - CORS configuration validation
   - Authentication token handling

5. **Critical dependency installation order:**
   1. Next.js and React core
   2. TypeScript and build tools
   3. shadcn/ui and styling frameworks
   4. State management (React Query, Zustand)
   5. Development tools and testing frameworks

## Tasks / Subtasks

- [x] Task 1: Initialize Next.js Project with TypeScript (AC: 1, 5)
  - [x] Create Next.js application with App Router in apps/web/
  - [x] Configure TypeScript 5.1.6+ with strict mode enabled (Epic 1 canonical)
  - [x] Setup next.config.js with optimizations and environment variables
  - [x] Create .env.example with NEXT_PUBLIC_API_URL=http://localhost:8001/api/v1
  - [x] Verify Next.js development server starts successfully

- [x] Task 2: Create Frontend Project Structure (AC: 1)
  - [x] Setup App Router directory structure (app/, components/, lib/)
  - [x] Create layout components (root layout, dashboard layout)
  - [x] Setup middleware for route protection
  - [x] Configure public/ directory for static assets
  - [x] Create utility directories (hooks/, store/, services/, types/, **tests**/)

- [x] Task 3: Configure Tailwind CSS and shadcn/ui (AC: 2, 5)
  - [x] Install and configure Tailwind CSS 3.3.0+ with Next.js
  - [x] Setup shadcn/ui CLI and initialize component library
  - [x] Configure tailwind.config.js with shadcn/ui theme settings
  - [x] Install Radix UI primitives and Lucide React icons
  - [x] Verify shadcn/ui installation with test component

- [x] Task 4: Setup State Management Dependencies (AC: 3, 5)
  - [x] Install React Query 5.x for server state management
  - [x] Install Zustand 4.x for client state management
  - [x] Configure React Query provider with default options
  - [x] Create initial Zustand stores for UI state
  - [x] Setup development tools (React Query DevTools)

- [x] Task 5: Configure API Client Integration (AC: 4)
  - [x] Create API client service with type-safe methods
  - [x] Configure environment variables for API base URL
  - [x] Setup error handling and response standardization
  - [x] Create React Query hooks for API endpoints
  - [x] Implement authentication token management

- [x] Task 6: Setup Dependency Management Strategy (AC: 3, 5)
  - [x] Create package.json with exact versions for critical dependencies
  - [x] Configure npm audit and vulnerability scanning
  - [x] Setup peer dependency validation checks
  - [x] Create installation validation script (check npm list, peer deps, TS compile)
  - [x] Document dependency installation order and troubleshooting

- [x] Task 7: Configure Testing Framework (AC: 5)
  - [x] Install Vitest with React Testing Library
  - [x] Configure test setup with Next.js compatibility
  - [x] Create test utilities and mock providers
  - [x] Setup MSW (Mock Service Worker) for API mocking with handlers for /health and /clients
  - [x] Implement sample component tests

- [x] Task 8: Implement Basic UI Components (AC: 2)
  - [x] Install core shadcn/ui components (Button, Card, Input, Select, Label, Form)
  - [x] Create layout components (Header, Sidebar, Footer)
  - [x] Implement basic dashboard page structure
  - [x] Create placeholder components for project list
  - [x] Setup navigation and routing

- [x] Task 9: Validate Frontend-Backend Integration (AC: 4)
  - [x] PREREQUISITE: Verify Story 1.3 backend is running (uvicorn core.main:app at localhost:8001)
  - [x] Configure CORS settings in Next.js for API communication
  - [x] Test API client connectivity to backend health endpoint (GET /api/v1/health)
  - [x] Verify environment variable loading
  - [x] Test error handling for API failures
  - [x] Validate type safety end-to-end (API to UI)

- [x] Task 10: Complete Installation Validation (AC: 1, 2, 3, 4, 5)
  - [x] Verify all dependencies install without conflicts
  - [x] Test Next.js application builds successfully (npm run build)
  - [x] Validate development server hot reload (npm run dev, edit src/app/page.tsx)
  - [x] Run test suite to ensure all tests pass (npm run test)
  - [x] Document setup procedures and common issues

## Dev Notes

### Previous Story Insights

From Story 1.3 (Backend API Foundation):

- Backend API running on http://localhost:8001 with health endpoint
- FastAPI with CORS middleware configured for frontend communication
- Type-safe API endpoints with Pydantic models
- Core entities implemented: Client, Service, Project with relationships
  [Source: docs/stories/1.3.backend-api-foundation-dependency-management.md#dev-agent-record]

### Tech Stack Requirements

**Frontend Framework:**

- Next.js 13.4.19+ with App Router (Epic 1 canonical version)
- React 18.2.0+ for concurrent features and server components
- TypeScript 5.1.6+ for type safety and developer experience (Epic 1 canonical for frontend)
  [Source: docs/epics/epic-1-foundation-infrastructure.md#story-1.4]

**UI Component Library:**

- shadcn/ui (Latest) - Accessible, customizable components built on Radix UI
- Tailwind CSS 3.4+ for utility-first styling
- Lucide React icons for consistent iconography
  [Source: docs/architecture/tech-stack.md#technology-stack-table]

**State Management:**

- React Query 5.x for server state (API data, caching, synchronization)
- Zustand 4.x for client state (UI preferences, navigation, theme)
  [Source: docs/architecture/tech-stack.md#technology-stack-table]

### Component Architecture

**Component Organization:**

```
apps/web/src/
├── app/                # Next.js App Router pages
│   ├── layout.tsx      # Root layout with auth
│   ├── page.tsx        # Dashboard homepage
│   ├── dashboard/      # Portfolio dashboard pages
│   ├── projects/       # Project management pages
│   └── clients/        # Client management pages
├── components/         # Reusable UI components
│   ├── ui/            # shadcn/ui base components
│   ├── forms/         # Form components with validation
│   ├── layout/        # Layout and navigation components
│   └── projects/      # Project-specific components
├── lib/               # Utility functions and configurations
├── hooks/             # Custom React hooks
├── store/             # Zustand state management
├── services/          # API service layer
└── types/             # TypeScript type definitions
```

[Source: docs/architecture/frontend-architecture.md#component-organization]

### API Integration

**API Client Configuration:**

- Base URL: `http://localhost:8001/api/v1` (development - confirmed from Story 1.3)
- Environment variable: `NEXT_PUBLIC_API_URL`
- Authentication: Bearer token via NextAuth.js (future story)
- Content-Type: `application/json`
- Error handling: Standardized ApiError class
  [Source: docs/stories/1.3.backend-api-foundation-dependency-management.md#completion-notes]

**Required API Service Methods:**

```typescript
// lib/api-client.ts
class ApiClient {
  private baseURL =
    process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8001/api/v1';

  async request<T>(endpoint: string, options?: RequestInit): Promise<T> {
    // Implement type-safe request handling
  }
}
```

[Source: docs/architecture/frontend-architecture.md#api-client-setup]

### State Management Patterns

**React Query Configuration:**

- Default stale time: 5 minutes
- Retry logic: 3 attempts with exponential backoff
- Cache invalidation on mutations
- Optimistic updates for better UX
  [Source: docs/architecture/frontend-architecture.md#state-structure]

**Zustand Store Structure:**

```typescript
interface AppState {
  sidebarOpen: boolean;
  currentLanguage: 'en' | 'fr';
  theme: 'light' | 'dark';
  toggleSidebar: () => void;
  setLanguage: (lang: 'en' | 'fr') => void;
}
```

[Source: docs/architecture/frontend-architecture.md#state-management-patterns]

### Data Models Integration

**TypeScript Interfaces for Core Entities:**

- Client: id, name, businessDomain, services[]
- Service: id, name, description, clientId, projects[]
- Project: id, name, description, serviceId, projectType, status, workflowState
- Shared with backend via packages/types/ for end-to-end type safety
  [Source: docs/architecture/data-models.md#client, #service, #project]

### Routing Architecture

**Next.js App Router Structure:**

- File-based routing with layouts
- Protected routes via middleware.ts
- Server components for data fetching
- Client components for interactivity
  [Source: docs/architecture/frontend-architecture.md#route-organization]

**Route Protection Pattern:**

```typescript
// middleware.ts
export function middleware(request: NextRequest) {
  const token = request.cookies.get('next-auth.session-token');
  if (!token && request.nextUrl.pathname.startsWith('/dashboard')) {
    return NextResponse.redirect(new URL('/auth/signin', request.url));
  }
}
```

[Source: docs/architecture/frontend-architecture.md#protected-route-pattern]

### File Locations

**CRITICAL: Current Project Source Tree (Run `ls -la` to verify before starting):**

```
/home/wsluser/dev/bmad-test/agent-lab/
├── apps/
│   └── api/                  # Backend (Story 1.3 - COMPLETED)
│       ├── core/
│       ├── models/
│       ├── tests/
│       └── pyproject.toml
├── docs/
│   ├── architecture/
│   ├── prd/
│   ├── epics/
│   └── stories/
└── package.json              # Root workspace config
```

**Frontend Application Structure TO BE CREATED:**

```
apps/web/                     # CREATE THIS DIRECTORY
├── package.json              # Frontend dependencies
├── next.config.js            # Next.js configuration
├── tailwind.config.js        # Tailwind CSS configuration
├── tsconfig.json             # TypeScript configuration
├── components.json           # shadcn/ui configuration
├── .env.example              # Environment variables template
├── src/
│   ├── app/                  # Next.js App Router
│   │   ├── layout.tsx        # Root layout with providers
│   │   ├── page.tsx          # Dashboard homepage
│   │   └── globals.css       # Global styles
│   ├── components/           # React components
│   │   ├── ui/              # shadcn/ui components
│   │   ├── layout/          # Layout components
│   │   └── projects/        # Project-specific components
│   ├── lib/                  # Utilities and configurations
│   │   ├── api-client.ts    # API client service
│   │   └── utils.ts         # Utility functions
│   ├── hooks/                # Custom React hooks
│   │   └── use-api.ts       # React Query hooks
│   ├── store/                # Zustand state management
│   │   └── app-store.ts     # Global UI state
│   ├── services/             # API service layer
│   │   ├── client-service.ts
│   │   └── project-service.ts
│   ├── types/                # TypeScript definitions
│   │   └── api.ts           # API types
│   └── __tests__/           # Test setup and utilities
│       ├── setup.ts         # Vitest setup
│       └── mocks/           # MSW handlers
└── public/                   # Static assets
    └── favicon.ico
```

[Source: docs/architecture/project-structure.md#repository-organization]

### Technical Constraints

**Version Requirements:**

- Node.js: 18.17.0 (from Epic 1 canonical specification)
- Next.js: 13.4.19+ for App Router stability
- TypeScript: 5.1.6+ with strict mode enabled (Epic 1 canonical for frontend)
- React: 18.2.0+ for server components and concurrent features
  [Source: docs/epics/epic-1-foundation-infrastructure.md#story-1.4]

**Build Configuration:**

- Strict TypeScript compilation
- ESLint validation on build
- Optimized production builds with code splitting
- Static asset optimization
  [Source: docs/architecture/coding-standards.md#critical-fullstack-rules]

**Performance Requirements:**

- Sub-second page load times
- Hot module replacement for development
- Optimized bundle sizes with tree shaking
- Image optimization with Next.js Image component
  [Source: docs/architecture/coding-standards.md#critical-fullstack-rules]

### Dependency Installation Order

**Critical Installation Sequence (MUST follow this order):**

1. **Next.js and React Core**: next@13.4.19+, react@18.2.0+, react-dom@18.2.0+
2. **TypeScript and Build Tools**: typescript@5.1.6+, @types/react, @types/node
3. **shadcn/ui and Styling**: tailwindcss@3.3.0+, shadcn/ui CLI, Radix UI primitives
4. **State Management**: @tanstack/react-query@5.x, zustand@4.x
5. **Development Tools**: vitest, @testing-library/react, msw
   [Source: Epic 1 Story 1.4 AC5]

### Testing

**Testing Framework Requirements:**

- **Frontend Testing**: Vitest (Vite-based, fast) with React Testing Library
- **Component Testing**: Unit tests for individual components with proper isolation
- **API Mocking**: MSW (Mock Service Worker) to mock backend API at http://localhost:8001/api/v1
- **Coverage Target**: 80% for UI components, 100% for utility functions
  [Source: docs/architecture/testing-strategy.md#frontend-tests]

**Test File Locations:**

```
apps/web/src/
├── __tests__/              # Test utilities and setup
│   ├── setup.ts            # Vitest configuration
│   └── mocks/
│       └── handlers.ts     # MSW request handlers
├── components/
│   └── __tests__/          # Component unit tests
├── hooks/
│   └── __tests__/          # Custom hook tests
├── lib/
│   └── __tests__/          # Utility function tests
└── app/
    └── __tests__/          # Page integration tests
```

[Source: docs/architecture/testing-strategy.md#test-organization]

**MSW Configuration for Story 1.4:**

- Mock backend endpoints from Story 1.3: GET /api/v1/health, POST /api/v1/clients
- Configure MSW handlers to simulate realistic API responses
- Setup test environment with proper base URL (http://localhost:8001/api/v1)

**Test Example Structure:**

```typescript
// components/__tests__/project-card.test.tsx
import { render, screen, fireEvent } from '@testing-library/react';
import { ProjectCard } from '../project-card';
import { mockProject } from '@agentlab/test-utils';

describe('ProjectCard', () => {
  it('displays project information correctly', () => {
    const project = mockProject({ name: 'Test Project' });
    render(<ProjectCard project={project} />);
    expect(screen.getByText('Test Project')).toBeInTheDocument();
  });
});
```

[Source: docs/architecture/testing-strategy.md#frontend-component-test]

### Environment Variables

**Required Frontend Environment Variables:**

```bash
# API Configuration
NEXT_PUBLIC_API_URL=http://localhost:8001/api/v1

# Application Configuration
NEXT_PUBLIC_APP_NAME=AgentLab
NEXT_PUBLIC_APP_VERSION=1.0.0

# Future: Authentication (NextAuth.js)
# NEXTAUTH_URL=http://localhost:3000
# NEXTAUTH_SECRET=<generated-secret>
```

### Integration with Backend

**CORS Configuration:**

- Backend already configured with CORS middleware in Story 1.3
- Frontend origin: http://localhost:3000 (development)
- Allowed methods: GET, POST, PUT, DELETE, OPTIONS
- Credentials: include (for future authentication)
  [Source: docs/stories/1.3.backend-api-foundation-dependency-management.md#completion-notes]

**Type Safety Bridge:**

- Shared TypeScript types via packages/types/ workspace
- Pydantic models from backend inform TypeScript interfaces
- End-to-end type safety from database to UI
  [Source: docs/architecture/project-structure.md#inter-package-dependencies]

## Coding Standards

**TypeScript/React Conventions:**

- Components: PascalCase (ProjectCard, WorkflowStatus)
- Files: kebab-case (project-card.tsx, workflow-status.tsx)
- Variables/Functions: camelCase (projectData, handleSubmit)
- Constants: UPPER_SNAKE_CASE (API_BASE_URL, MAX_FILE_SIZE)
- Types/Interfaces: PascalCase (Project, WorkflowState)
  [Source: docs/architecture/coding-standards.md#naming-conventions]

**Component Structure:**

```typescript
export interface ComponentProps {
  // Props definition
}

export function Component({ ...props }: ComponentProps) {
  // Hooks
  // Event handlers
  // Render logic
  return (
    // JSX
  );
}
```

[Source: docs/architecture/coding-standards.md#frontend-structure]

**Import Organization:**

```typescript
// External libraries
import React from 'react';
import { NextPage } from 'next';

// Internal packages (monorepo)
import { Project } from '@agentlab/types';
import { Button } from '@agentlab/ui';

// Relative imports (same app)
import { ProjectCard } from '../components/project-card';
import { useProjects } from '../hooks/use-projects';
```

[Source: docs/architecture/coding-standards.md#import-organization]

## Change Log

| Date       | Version | Description                                                                                                                                                                                                                           | Author                |
| ---------- | ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------- |
| 2025-09-30 | 1.0     | Initial story creation for Frontend Foundation                                                                                                                                                                                        | Bob (Scrum Master)    |
| 2025-09-30 | 1.1     | Fixed TypeScript version to Epic 1 canonical 5.1.6+, added explicit source tree structure, reordered tasks for logical implementation, added backend prerequisite to Task 9, resolved epic file location, enhanced Testing subsection | James (Dev Agent)     |
| 2025-09-30 | 1.2     | PO validation complete - corrected final TS version reference in Dev Notes line 134, approved story for implementation                                                                                                                | Sarah (Product Owner) |

## Dev Agent Record

### Agent Model Used

- **Model**: [To be filled by Dev Agent]
- **Date**: [To be filled by Dev Agent]

### Debug Log References

[To be filled by Dev Agent during implementation]

### Completion Notes List

[To be filled by Dev Agent during implementation]

### File List

[To be filled by Dev Agent during implementation]

## QA Results

[To be filled by QA Agent after implementation review]
